<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="css/bootstrap.css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="css/main.css">
<script src=http://code.jquery.com/jquery-2.0.3.min.js></script>
<script src=http:////netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js></script>
<script src=js/handlebars-v1.1.2.js></script>
<script src=js/amplify.min.js></script>

<!-- Define default template -->
<script data-body type="text/x-handlebars-template">
{{>header}}
{{>body}}
</script>
<!-- Include header -->
<script data-name="header" src="tmpl/header.tmpl"></script>

<script data-name="body" type="text/x-handlebars-template">
<div class="page-header" style="background:#fff">
	<div class="container">
		<div class="dropdown">
			<a href="#" data-toggle="dropdown"><h2>Everything <img src="img/fravr-dropdown.png"></h2></a>
			<ul class="dropdown-menu">
				<li><a href="#">Everything</a></li>
				<li><a href="#">Social</a></li>
				<li><a href="#">Recommended</a></li>
			</ul>
		</div>
	</div>
</div>
<!--
<div class="fravr-timeline">
<div class="container">
	<div class="row">
		<div class="col-md-6">
		</div>
		<div class="col-md-6">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-4">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
		<div class="col-md-4">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
		<div class="col-md-4">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-6">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
		<div class="col-md-6">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-3">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
		<div class="col-md-3">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
		<div class="col-md-3">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
		<div class="col-md-3">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-6">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
		<div class="col-md-6">
			<div class="item">
				<img src="img/products/Brick Full Grain NYC NATO Watch Strap by Worn & Wound 59.jpg">
				<span class="title">Brick Full Grain NYC NATO Watch Strap</span>
				<span class="subtitle">by Sinn</span>
			</div>
		</div>
	</div>
</div>
</div>
-->
</script>
<script data-item type="text/x-handlebars-template">
<div class="item">
	<img src="{{product.img_urls.0.url}}">
	<span class="title">{{product.name}}</span>
	{{#if actions}}
	<span class="subtitle">by {{product.merchant}}</span>
	{{else}}
		{{#ifequals actions.length 0}}
		<span class="subtitle">by {{product.merchant}}</span>
		{{else}}
			{{#ifequals actions.length 1}}
				{{#ifequals actions.0.action 'purchase'}}
					<span class="subtitle">by {{product.merchant}}</span>
				{{/ifequals}}
			{{else}}
			<span class="subtitle"></span>
			{{/ifequals}}
		{{/ifequals}}
	{{/if}}
</div>
</script>
<script src=data/data.js></script>
<script src=js/main.js></script>
<!-- Events -->
<script>
//Compile timeline template
Template.set('timeline', $('script[data-item]').html());

//Generate html code in body and register partial 'timeline'
var Timeline = function (type) {
	var that = {};
	var timeline = $("<div class='fravr-timeline'></div>"),
		container = $("<div class='container'></div>"),
		row = $("<div class='row'></div>"),
		count = Data.timeline[type].length,
		pointer = 0,
		buffer = {};

	that.getRW = function () {
		var rAllowed = [
			// Allowable aspect ratios r and corresponding width w
			{
				r: 0.333333333,
				w: [9]
			}
			{
				r: 0.375,
				w: [8]
			},
			{
				r: 0.388888889,
				w: [9]
			},
			{
				r: 0.428571429,
				w: [7]
			},
			{
				r: 0.4375,
				w: [8]
			},
			{
				r: 0.444444444,
				w: [9]
			},
			{
				r: 0.5,
				w: [6,7,8,9]
			},
			{
				r: 0.555555556,
				w: [9]
			},
			{
				r: 0.5625,
				w: [8]
			},
			{
				r: 0.571428571,
				w: [7]
			},
			{
				r: 0.583333333,
				w: [6]
			},
			{
				r: 0.6,
				w: [5]
			},
			{
				r: 0.611111111,
				w: [9]
			},
			{
				r: 0.625,
				w: [8]
			},
			{
				r: 0.642857143,
				w: [7]
			},
			{
				r: 0.666666667,
				w: [6,9]
			},
			{
				r: 0.6875,
				w: [8]
			},
			{
				r: 0.7,
				w: [5]
			},
			{
				r: 0.714285714,
				w: [7]
			},
			{
				r: 0.75,
				w: [4,6,8]
			},
			{
				r: 0.785714286,
				w: [7]
			},
			{
				r: 0.8,
				w: [5]
			},
			{
				r: 0.833333333,
				w: [6]
			},
			{
				r: 0.857142857,
				w: [7]
			},
			{
				r: 0.875,
				w: [4]
			},
			{
				r: 0.9,
				w: [5]
			},
			{
				r: 0.916666667,
				w: [6]
			},
			{
				r: 1,
				w: [3,4,5,6]
			},
			{
				r: 1.1,
				w: [5]
			},
			{
				r: 1.125,
				w: [4]
			},
			{
				r: 1.166666667,
				w: [3]
			},
			{
				r: 1.2,
				w: [5]
			},
			{
				r: 1.25,
				w: [4]
			},
			{
				r: 1.333333333,
				w: [3]
			},
			{
				r: 1.375,
				w: [4]
			},
			{
				r: 1.5,
				w: [3,4]
			},
			{
				r: 1.666666667,
				w: [3]
			},
			{
				r: 1.833333333,
				w: [3]
			},
			{
				r: 2
				w: [3]
			}
		]
	}
	// var	matrix = [
	// 	{
	// 		w: [6, 6],
	// 		r: [[0.5,1],[0.5,1]]
	// 	},
	// 	{
	// 		w: [3,3,3,3],
	// 		r: [[1,2],[1,2],[1,2],[1,2]]
	// 	},
	// 	{
	// 		w: [4,4,4],
	// 		r: [[0.75,1.5],[0.75,1.5],[0.75,1.5]]
	// 	},
	// 	{
	// 		w: [3,9],
	// 		r: [[1,2],[1/3,2/3]]
	// 	},
	// 	{
	// 		w: [4,8],
	// 		r: [[0.75,1.5],[0.375,0.75]]
	// 	},
	// 	{
	// 		w: [3,6,3],
	// 		r: [[1,2],[,0.75]]
	// 	},
	// ];

	that.loadSize = function (num, successCallback) {
		var imgLoadCount = 0;
		for (var y=pointer+num; pointer<y; pointer+=1) {
			if (typeof Data.timeline[type][pointer] === 'undefined') break;
			var image = new Image();
			$(image).load(function (timelineItem) {
					var that = function () {
						var width = $(this).width();
						var height = $(this).height();
						Data.timeline[type][timelineItem].product.img_urls[0].size = {
							width: width,
							height: height,
							hdw: height/width
						}
						$(this).remove(); //Remove this image from DOM
						imgLoadCount += 1;
						if (imgLoadCount === num) {
							successCallback(pointer);
						};
					};
					return that;
				}(pointer));
			$(image).css('display','none')
				.attr('src', Data.timeline[type][pointer].product.img_urls[0].url)
				.appendTo('body');
		}
		if (pointer != y) return 'All sizes loaded';
	}

	that.create = function () {
		var loadNum = 1;
		that.loadSize(loadNum, function (pointer) {
			var size = [];
			for (var i=pointer-loadNum; i<pointer; i+=1) {
				size.push(Data.timeline[type][i].product.img_urls[0].size)
			}
			console.log(size);
		// that.loadSize(loadnum, function (pointer) {
		// 	var size1 = Data.timeline[type][pointer-loadNum].product.img_urls[0].size;
		// 	var size2 = Data.timeline[type][pointer-loadNum+1].product.img_urls[0].size;

		// 	if (size1.width/size1.height)
		});
	}

	return that;
};

$( document ).ready(function () {
	$('a[data-toggle]').on('click', function (event) {
		event.preventDefault();
	});

	var timeline = new Timeline('everything');
	timeline.create();
});

// window.onload(function () {
// 	// var timeline = new Timeline('everything');
// 	console.log("asdf");
// });
</script>
</head>

<body style="background:#f1f1f1">
</body>
</html>
