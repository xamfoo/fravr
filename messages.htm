<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="css/bootstrap.css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="css/main.css">
<script src=http://code.jquery.com/jquery-2.0.3.min.js></script>
<script src=http:////netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js></script>
<script src=js/handlebars-v1.1.2.js></script>
<script src=js/amplify.min.js></script>

<!-- Define default template -->
<script data-body type="text/x-handlebars-template">
{{>header}}
{{>body}}
</script>
<!-- Include header -->
<script data-name="header" src="tmpl/header.tmpl"></script>

<script data-name="body" type="text/x-handlebars-template">
<div class="container">
	<div class="fravr-messages">
		<div class="row">
			<div class="col-xs-12">
				<div class="messages-head default-border">
					<div class="row">		
						<div class="col-sm-2 col-md-1 ">
							<img src="{{profile.img_url}}" class="img-responsive">
						</div>
						<div class="col-sm-10 col-md-11">
							<h3 class="title">{{profile.name}}'s Messages</h3>
							<div class="subtitle">
								<h5><a href="#">x unread </a></h5> 
								:
								<h5><a href="#">{{#arraylength chat}}{{/arraylength}} conversations </a></h5>
							</div>
						</div>
					</div>
				</div>
			</div> <!--/messages-head-->
		</div> <!--/row-->
		<div class="row">
			<div class="col-sm-4">
				<div class="list-group chat-tabs default-border">
				{{#each chat}}
					<a href="#" class="list-group-item {{#ifequals this.active true}}active{{/ifequals}}">
						 <div class="row">
							<div class="col-xs-2 rm-right-padding">
								<img src="{{this.conversation_participants.0.img_url}}" class="img-responsive">
							</div>
							<div class="col-xs-10">
								<h4 class="list-group-item-heading">
									{{this.conversation_name}}
									<span class="unread_flag">
										{{#countunread this.conversation_msges}}
											{{#if this}} ({{this}}){{/if}}
										{{/countunread}}
									</span>
								</h4>
								<p class="list-group-item-text text-ellipsis">{{#lastvalue conversation_msges}}{{this.msg}}{{/lastvalue}}</p>
							 </div>
						 </div>
					</a>
				{{/each}}
				</div>
			</div>
			<div class="col-sm-8 ">
				<div class="chat-screen default-border">
				{{#each chat_current.conversation_msges}}
						{{#ifequals this.by "Paklun"}}
							<div class="msg_self"><h5>{{{../msg}}}</h5></div>
							<hr/>
						{{else}}
							<div class="msg_others">
								<h5 class="name">{{this}}</h5>
								<h5 class="msg">{{{../msg}}}</h5>
							</div>
							<hr/>
						{{/ifequals}}
				{{/each}}
				<div class="row">
					<div class="col-sm-11 rm-right-padding">
						<textarea class="form-control" rows="3"> Type your message here </textarea>
					</div>
					<div class="col-sm-1 rm-left-padding">
						<button type="button" class="btn btn-default btn-lg rm-padding">
							<span class="glyphicon glyphicon-paperclip btn-lg"></span>
						</button>
						<button type="button" class="btn btn-default btn-lg rm-padding">
							<span class="glyphicon glyphicon-send btn-lg"></span>
						</button>
					</div>
				</div>	
				
				
			</div>
		</div>
		
	</div> <!--/fravr-messages-->
</div> <!--/container-->

</script>
<script src=data/data.js></script>
<script src=js/main.js></script>
<!-- Page specific script -->
<script>
Handlebars.registerHelper ("countunread", function (obj, options) {
	var unread = 0;
	for (var i=0; i<obj.length; i++ ) {
		if (obj[i].unread) {
			unread++;
		}
	}
	return options.fn(unread);
});

Main.ready(function () {
	// adjust chat window height to viewport 
	var ht = $(window).height() - '120' - $('.messages-head').height();
	console.log($('.messages-head').height());
	console.log($(window).height());
	$('.chat-tabs').height(ht);

	$('.list-group-item').click(function(evt){
		evt.preventDefault();
		var idx = $(this).index();
		Data.chat_current.active = false;
		Data.chat_current = Data.chat[idx];
		Data.chat_current.active = true;
		Template.render();
	});
});

</script>
</head>

<body>
</body>
</html>
